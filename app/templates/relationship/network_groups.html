{% extends "single_column.html" %}
{% from "macros.html" import form_render, field_render, modal_render, render_errors %}

{% block content_narrow_form %}

        <form action="/groupadd" method="post">
            {{form_render(GroupSearch)}}
            <a href="{{url_for('relationship.group_create')}}">Create New Group</a>
        </form>
        <br>
        <div id="network_groups"></div>
        <!-- list of groups user belongs to -->
        <div class="row justify-content-center">
        <h3>Your Groups</h3>
        <ul class="nav">
                {% set pending_count = current_user.sentgrouprequests | count + 
                GroupMemberApprove.choices | length %}
                <a href="" class="nav-link" data-toggle="modal" data-target="#pending_groups">Pending<span>({{pending_count}})</span></a>
                <a href="" class="nav-link" data-toggle="modal" data-target="#GroupDelete">Delete</a>
            </li>
        </ul>
        </div>
        <ul>
            {% for group in current_user.groups %}
            <li> 
            <a href="{{url_for('relationship.group', name=group.name, id=group.id)}}">
            {{ group["name"] }} </a></li>
            {% endfor %}
        </ul>
        <br>
{% endblock content_narrow_form %}


{% block modal %}

    {% if modal_open['modal'] != false %}
        
        <script>
            var modal = {{modal_open|tojson}}.modal
            console.log(modal)
            $(window).on('load', function(){
            $(modal).modal('show');
        });
        </script>
    {% endif %}
 
    <!-- Modal to delete groups -->
    {{modal_render(GroupDelete, "Delete Groups", action=url_for('relationship.group_remove'), modalID="GroupDelete")}}


    <!-- Modal for Pending Group Requests / admin approval of incoming requests -->
    <div class="modal" id="pending_groups" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-md" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">Pending Groups</h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body px-5">
                        <h5>Sent</h5>
                            <ul>
                                {% if current_user.sentgrouprequests == [] %}
                                    <li>None</li>
                                {% else %}
                                    {% for request in current_user.sentgrouprequests %}
                                        <li>{{request.group.name}}</li>
                                    {% endfor %}
                                {% endif %}
                            </ul>
                        <!--if admin display none or list of pending approvals -->
                        {% if current_user.group_admin | length > 0 %}
                            {% if GroupRequest.get_pending(current_user) != [] %}
                            <form id = "modal_form_group" action="{{url_for('relationship.group_approve')}}" method="POST">
                                <h5>Received <small>(Select and submit to approve)</small></h5>
                                {{GroupMemberApprove.hidden_tag()}}
                                {{GroupMemberApprove.request()}}
                                {{render_errors(GroupMemberApprove.request)}}
                            {% else %}
                                <h5>Received</h5>
                                    <ul>
                                        <li>None</li>
                                    </ul>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        {% if GroupRequest.get_pending(current_user) != [] %}
                            {{GroupMemberApprove.submit(class_=("btn btn-primary btn-block-submit submit"))}}
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

{% endblock %}

